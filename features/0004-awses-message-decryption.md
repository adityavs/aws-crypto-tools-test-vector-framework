
|           |                                      |
|:----------|:-------------------------------------|
|__Feature__|AWS Encryption SDK Message Decryption |
|__Version__|1                                     |
|__Created__|2018-06-25                            |
|__Updated__|2018-08-14                            |

## Dependencies

This serves as a reference of all features that this feature depends on.

| Feature                                             | Min Version | Max Version |
|-----------------------------------------------------|-------------|-------------|
| [0002-keys](./0002-keys.md)                         | 1           | n/a         |
| [0005-awses-master-key](./0005-awses-master-key.md) | 1           | n/a         |

## Experimental Implementations

This serves as a reference for which implementations support this experimental feature. This
section should be removed once this feature is promoted from experimental status.

Unique implementations required for promotion: 2

| Repository                                                                         | Language | Pull Request                                             |
|------------------------------------------------------------------------------------|----------|----------------------------------------------------------|
| https://github.com/aws/aws-encryption-sdk-python/tree/master/test_vector_generator | Python   | https://github.com/aws/aws-encryption-sdk-python/pull/63 |
| Link to GitHub repository                                                          | Language | Pull request that added support                          |

## Supported Implementations

This serves as a references for which implementations support this feature. A minimum of two supporting implementations
are required for new feature versions.

| Repository                | Language | Feature Version                   | Minimum Version                                    | Pull Request                    |
|---------------------------|----------|-----------------------------------|----------------------------------------------------|---------------------------------|
| Link to GitHub repository | Language | Supported version of this feature | Minimum version that supports this feature version | Pull request that added support |
| Link to GitHub repository | Language | Supported version of this feature | Minimum version that supports this feature version | Pull request that added support |

## Summary

An AWS Encryption SDK Message Decryption manifest defines static test vectors for full AWS
Encryption SDK ciphertext messages along with sufficient metadata to decrypt them.

## Out of Scope

These manifests do not include any description of how the test vectors were created. 
That is covered by [0003-awses-message-encryption](0003-awses-message-encryption.md).

## Motivation

We need a way of describing full AWS Encryption SDK ciphertext message test vectors and how to 
decrypt them. This will be used both for using an unknown implementation to decrypt known good
test vectors and for using a known good implementation to decrypt ciphertexts generated by an
unknown implementation.

## Guide-level Explanation

This type of manifest describes test cases of full AWS Encryption SDK ciphertext messages and
corresponding plaintexts. Each test case definition includes metadata that describes the master
key(s) required for decryption.

In addition to describing the test cases, the manifest also identifies the client and version 
that created the ciphertext.

### Processing Workflow

To process a manifest of this type, a compatible handler must first read a message decryption
manifest and the keys manifest that it must identify. This will give the handler with enough
information about the test cases to successfully process them.

The handler must now process the described test cases, decrypting the identified ciphertext
and validating the result against the identified plaintext.


## Reference-level Explanation

### Contents

#### manifest

Map identifying the manifest.

* `type` : Identifies the manifest as an AWS Encryption SDK message decryption manifest.
    * Must be `awses-decrypt`
* `version` : Identifies the version of this feature document that describes the manifest.

#### client

Identifies the client used to generate these test vectors.

* `name`: Identifies the client
  * If the client is on github, must the the github repository name (ex: `awslabs/aws-encryption-sdk-python`)
* `version`: Identifies the client version

#### keys

URI identifying a keys manifest to use with all test cases.

#### tests

JSON object mapping test case IDs to test case descriptions.

* `description` : Description of ciphertext test case (optional)
* `plaintext` : URI that identifies the plaintext
* `ciphertext` : URI that identifies the ciphertext
* `master-keys` : List of master key descriptions as defined in [0005-awses-master-key](./0005-awses-master-key.md)

### Example

```json
{
    "manifest": {
        "type": "awses-decrypt",
        "version": 1
    },
    "client": {
        "name": "awslabs/aws-encryption-sdk-python",
        "version": "1.3.4"
    },
    "keys": "file://relative/file/path.json",
    "tests": {
        "2d1e0da9-74f8-4817-842d-c2b973abed7c": {
            "description": "Single raw rsa provider encryption",
            "plaintext": "file://relative/path/to/plaintext",
            "ciphertext": "file://relative/path/to/ciphertext",
            "master-keys": [
                {
                    "type": "raw",
                    "provider-id": "aws-raw-vectors-persistant",
                    "key": "rsa-2048",
                    "encryption-algorithm": "rsa",
                    "padding-algorithm": "oaep-mgf1",
                    "padding-hash": "sha256"
                }
            ]
        },
        "f7f3416b-7527-4108-8d15-6d0d5a377a2c": {
            "description": "Single aws kms provider encryption",
            "plaintext": "file://relative/path/to/plaintext",
            "ciphertext": "file://relative/path/to/ciphertext",
            "master-keys": [
                {
                    "type": "aws-kms",
                    "key": "us-west-2-decryptable"
                }
            ]
        }
    }
}
```
